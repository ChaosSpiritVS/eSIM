<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>分类 · 帮助中心</title>
    <link rel="stylesheet" href="styles.css?v=20251210">
    <script src="data.js?v=20251210"></script>
    <script src="help.js?v=20251210"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
  </head>
  <body>
    <div class="screen">
      <div class="nav" id="nav"><h1>分类</h1></div>
      <div class="content" id="content"></div>
    </div>
    <script>
      syncUrlWithStoredLocale();
      const lang = detectLang();
      const locale = detectLocale();
      document.documentElement.lang = locale;
      const url = new URL(window.location.href);
      const catParam = url.searchParams.get('cat');
      const catCn = catParam ? decodeURIComponent(catParam) : null;
      const headerTitle = catCn ? localizedCategoryDisplayName(catCn, locale) : locStr('help_center', locale);
      renderHeader(document.getElementById('nav'), headerTitle, lang, `index.html?lang=${lang}&locale=${locale}${isIOSHost()? '&ios=1':''}`);
      const bl = document.getElementById('backLabel'); if (bl) bl.textContent = locStr('back_all', locale);
      const content = document.getElementById('content');
      renderLangToggle(content, lang);
      renderSearch(content, lang);
      const card = document.createElement('div'); card.className='card';
      const ul = document.createElement('ul'); ul.className='list';
      function renderArticles(files) {
        ul.innerHTML='';
        files.forEach(fileName=>{
          const a = { catCn: catCn, file: fileName, id: fileName };
          const li = document.createElement('li');
          const left = document.createElement('span'); left.textContent=fileName.replace(/\.docx$/i, '');
          const right = document.createElement('span'); right.textContent='›';
          li.appendChild(left); li.appendChild(right);
          hydrateArticleTitle(left, a, locale, left.textContent);
          li.addEventListener('click', () =>{ window.location.href = `article.html?cat=${encodeURIComponent(catCn)}&file=${encodeURIComponent(fileName)}&lang=${lang}&locale=${locale}${isIOSHost()? '&ios=1':''}`; });
          ul.appendChild(li);
        });
      }
      if (catCn) {
        listArticles(catCn, locale).then(renderArticles).catch(()=>{
          const cat = HelpData.categories.find(c=>categoryTitle(c, locale)===catCn || c.zh===catCn || c.en===catCn) || HelpData.categories[0];
          const fall = HelpData.articles.filter(a=>a.cat===cat.id);
          renderArticles(fall.map(a=> a.file));
        });
      }
      card.appendChild(ul);
      content.appendChild(card);
    </script>
  </body>
</html>
